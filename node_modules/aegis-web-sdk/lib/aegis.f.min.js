/**
 *  =================================================================
 * aegis-web-sdk@1.36.5 (c) 2022 TencentCloud Real User Monitoring.
 * Author pumpkincai.
 * Last Release Time Thu Nov 24 2022 16:10:40 GMT+0800 (中国标准时间).
 * Released under the MIT License.
 * Thanks for supporting RUM & Aegis!
 * =================================================================
 **/
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=n()}(this,function(){"use strict";var _,U;function q(e){this.name="__st"+(1e9*Math.random()>>>0)+_+"__",null!=e&&e.forEach(this.add,this),_+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var n=Object(this),t=n.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],i=0;i<t;){var r=n[i];if(e.call(o,r,i,n))return r;i+=1}}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,n){return this.substring(n=!n||n<0?0:+n,n+e.length)===e}}),window.WeakSet||(_=Date.now()%1e9,q.prototype.add=function(e){var n=this.name;return e[n]||Object.defineProperty(e,n,{value:!0,writable:!0}),this},q.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},q.prototype.has=function(e){return!!e[this.name]},U=q,Object.defineProperty(window,"WeakSet",{value:function(e){return new U(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),t=1;t<arguments.length;t++)if(null!=(o=arguments[t]))for(var o=Object(o),i=Object.keys(Object(o)),r=0,a=i.length;r<a;r++){var s=i[r],u=Object.getOwnPropertyDescriptor(o,s);null!=u&&u.enumerable&&(n[s]=o[s])}return n}});var B=function(e,n){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},E=function(){return(E=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function u(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;for(var o=Array(e),i=0,n=0;n<t;n++)for(var r=arguments[n],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o}function D(n){try{return encodeURIComponent(decodeURIComponent(n))}catch(e){return n}}var T,F=["ext1","ext2","ext3","level","trace","tag","seq","code"],M=(e.prototype.indexOf=function(e,n){for(var t=0;t<e.length;t++)if(e[t].callback===n)return t;return-1},e.prototype.on=function(e,n,t){var o;if(void 0===t&&(t=0),this)return(o=this.eventsList[e])||(this.eventsList[e]=[],o=this.eventsList[e]),-1===this.indexOf(o,n)&&o.push({name:e,type:t||0,callback:n}),this},e.prototype.one=function(e,n){this.on(e,n,1)},e.prototype.remove=function(e,n){if(this){var t=this.eventsList[e];if(t){if(n)return t.length&&(n=this.indexOf(t,n),t.splice(n,1)),this;try{delete this.eventsList[e]}catch(e){}}return null}},e.prototype.clear=function(){this.eventsList={}},e),W=function(e){if(!e||0===e.length)return"{}";e=Array.isArray(e)?e:[e];var n=Object.keys(e[0]),t={};return n.forEach(function(n){t[n]=e.map(function(e){return e[n]})}),t.count=e.length,oe(t)};function e(){var a=this;this.emit=function(e,n){if(a){var t;if(null!=(o=a.eventsList[e])&&o.length)for(var o=o.slice(),i=0;i<o.length;i++){t=o[i];try{var r=t.callback.apply(a,[n]);if(1===t.type&&a.remove(e,t.callback),!1===r)break}catch(e){throw e}}return a}},this.eventsList={}}(n=T=T||{})[n.number=-1]="number",n.string="";function G(e,n){return"number"==typeof e||"string"==typeof e?e:n?T.string:T.number}function P(e,n){return"string"==typeof e?e.split("?")[n?1:0]||"":e}function C(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}function X(e,n,t){var o,i;try{if("function"==typeof(null==n?void 0:n.retCodeHandler))return{code:void 0===(r=(i=n.retCodeHandler(e,null==t?void 0:t.url,null==t?void 0:t.ctx,null==t?void 0:t.payload)||{}).code)?"unknown":r,isErr:i.isErr};"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null==(o=null==n?void 0:n.ret)?void 0:o.join)&&(ne=[].concat(n.ret.map(function(e){return e.toLowerCase()})));var r,a=Object.getOwnPropertyNames(e).filter(function(e){return-1!==ne.indexOf(e.toLowerCase())});return a.length?{code:""+(r=e[a[0]]),isErr:0!==r&&"0"!==r}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}function L(e,n,t){try{var o="function"==typeof n?n(e,null==t?void 0:t.url)||"":e;return ie(o).slice(0,102400)}catch(e){return""}}function V(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})}function $(t,o){var i,r=[],a=t.config;return t.lifeCycle.on("destroy",function(){r.length=0}),function(e,n){Array.isArray(e)?r=r.concat(e):r.push(e),o&&r.length>=o||t.sendNow&&0<r.length?(r=se(r),n(r.splice(0,r.length)),i&&clearTimeout(i)):(i&&clearTimeout(i),i=setTimeout(function(){i=null,0<(r=se(r)).length&&n(r.splice(0,r.length))},a.delay))}}function J(e,n){return Array.isArray(e)?n(e.map(function(e){return n=E(E({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(S).join(" ")}),F.forEach(function(e){n[e]||delete n[e]}),n;var n})):n([E(E({},e),{msg:"string"==typeof e.msg?e.msg:S(e.msg)})])}function K(u,c){return function(e,n){var t,o,i,r=Array.isArray(e),a=r?e:[e],s=(u.lifeCycle.emit("beforeRequest",e),u.config.beforeRequest);(a="function"==typeof s?a.map(function(n){try{var e=s({logs:n,logType:c});return(null==e?void 0:e.logType)===c&&null!=e&&e.logs?e.logs:!1!==e&&n}catch(e){return n}}).filter(function(e){return!1!==e}):a).length&&(t=a,e=F,!Array.isArray(t)||t.length<=1||(o=[],i=[],!(i="string"==typeof e?[e]:e)||i.length<=0||(i.forEach(function(n){t.forEach(function(e){null!=e&&e[n]&&o.push(n)})}),0<o.length&&(t=t.map(function(e){var n={};return o.forEach(function(e){n[e]=""}),E(E({},n),e)})))),a=t,n(r?a:a[0]))}}function Y(i){return function(e,n){i.lifeCycle.emit("modifyRequest",e);var t=i.config.modifyRequest;if("function"==typeof t)try{var o=t(e);"object"==typeof o&&"url"in o&&(e=o)}catch(e){console.error(e)}n(e)}}function Q(o){return function(e,n){o.lifeCycle.emit("afterRequest",e);var t=o.config.afterRequest;"function"==typeof t&&!1===t(e)||n(e)}}function v(t){if(t&&t.reduce&&t.length)return 1===t.length?function(e,n){t[0](e,n||fe)}:t.reduce(function(t,o){return function(e,n){return void 0===n&&(n=fe),t(e,function(e){return null==o?void 0:o(e,n)})}});throw new TypeError("createPipeline need at least one function param")}function z(n,t){Object.getOwnPropertyNames(n).forEach(function(e){"function"==typeof n[e]&&"constructor"!==e&&(t?t[e]="sendPipeline"===e?function(){return function(){}}:function(){}:n[e]=function(){})})}var x,R,l,Z=["application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video"],ee=/\.(json|js|css|jpg|jpeg|png|svg|apng|webp|gif|bmp|mp4|mp3|mpeg|wav|webm|ogg|flv|m3u8|ttf|woff2|otf|eot|woff|)$/gi,ne=["ret","retcode","code","errcode"],te=function(){var t=new WeakSet;return function(e,n){if(n instanceof Error)return"Error.message: "+n.message+" \n  Error.stack: "+n.stack;if("object"==typeof n&&null!==n){if(t.has(n))return"[Circular "+(e||"root")+"]";t.add(n)}return n}},S=function(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,te(),4)||"undefined").replace(/"/gim,""):JSON.stringify(e,te(),4)||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},oe=function(e){if("string"==typeof e)return e;try{return JSON.stringify(e,te())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},ie=function(t,o){void 0===o&&(o=3);var i,r,a,s="";return Array.isArray(t)?(s+="[",i=t.length,t.forEach(function(e,n){s=(s+="object"==typeof e&&1<o?ie(e,o-1):ae(e))+(n===i-1?"":",")}),s+="]"):t instanceof Object?(s="{",r=Object.keys(t),a=r.length,r.forEach(function(e,n){"object"==typeof t[e]&&1<o?s+='"'+e+'":'+ie(t[e],o-1):s+=re(e,t[e]),s+=n===a-1||n<a-1&&void 0===t[r[n+1]]?"":","}),s+="}"):s+=t,s},re=function(e,n){var t=typeof n,o="";return"string"==t||"object"==t?o+='"'+e+'":"'+n+'"':"function"==typeof n?o+='"'+e+'":"function '+n.name+'"':"symbol"==typeof n?o+='"'+e+'":"symbol"':"number"!=typeof n&&"boolean"!=t||(o+='"'+e+'": '+n),o},ae=function(e){var n=typeof e;return""+("undefined"==n||"symbol"==n||"function"==n?"null":"string"==n||"object"==n?'"'+e+'"':e)},se=((n=x=x||{}).INFO_ALL="-1",n.API_RESPONSE="1",n.INFO="2",n.ERROR="4",n.PROMISE_ERROR="8",n.AJAX_ERROR="16",n.SCRIPT_ERROR="32",n.IMAGE_ERROR="64",n.CSS_ERROR="128",n.CONSOLE_ERROR="256",n.MEDIA_ERROR="512",n.RET_ERROR="1024",n.REPORT="2048",n.PV="4096",n.EVENT="8192",n.PAGE_NOT_FOUND_ERROR="16384",n.WEBSOCKET_ERROR="32768",n.BRIDGE_ERROR="65536",(n=R=R||{}).LOG="log",n.SPEED="speed",n.PERFORMANCE="performance",n.OFFLINE="offline",n.WHITE_LIST="whiteList",n.VITALS="vitals",n.PV="pv",n.CUSTOM_PV="customPV",n.EVENT="event",n.CUSTOM="custom",n.SDK_ERROR="sdkError",n.SET_DATA="setData",n.LOAD_PACKAGE="loadPackage",(n=l=l||{}).production="production",n.development="development",n.gray="gray",n.pre="pre",n.daily="daily",n.local="local",n.test="test",n.others="others",function(e){return e.filter(function(t,o){return"static"!==t.type||!e.find(function(e,n){return t.url===e.url&&200===t.status&&o<n})})}),ue=function(e){e.level===x.INFO_ALL&&(e.level=x.INFO)},ce=function(e){return(Array.isArray(e)?e:[e]).map(function(t){return Object.getOwnPropertyNames(t).reduce(function(e,n){return"ctx"!==n&&(e[n]=t[n]),e},{level:x.INFO,msg:""})})},le=function(o){return function(e){return o.sendPipeline([function(e,t){return t({url:o.config.url||"",data:W(ce(e)),method:"post",contentType:"application/json",type:R.LOG,log:e,requestConfig:{timeout:5e3},success:function(){var n=o.config.onReport;"function"==typeof n&&e.forEach(function(e){n(e)}),"function"==typeof t&&t([])},fail:function(e){"403 forbidden"===e&&o.destroy()}})}],R.LOG)(e)}},fe=function(){},n=(Object.defineProperty(y.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.36.5"},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),x},enumerable:!1,configurable:!0}),y.prototype.init=function(e){this.setConfig(e);for(var n=0;n<y.installedPlugins.length;n++)try{y.installedPlugins[n].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},y.prototype.setConfig=function(e){Object.assign(this.config,e);var e=this.config,n=e.id,t=e.uin,o=e.version,i=e.ext1,r=e.ext2,a=e.ext3,s=e.aid,u=e.env,c=void 0===u?"production":u,u=e.pageUrl,e=this.bean.id!==n||this.bean.uin!==t||this.bean.aid!==s;return this.bean.id=n||"",this.bean.uin=t||"",this.bean.version=o||"1.36.5",this.bean.aid=s||"",this.bean.env=function(){switch(c){case l.production:case l.development:case l.gray:case l.pre:case l.daily:case l.local:case l.test:case l.others:return 1;default:return}}()?c:l.others,u&&this.extendBean("from",encodeURIComponent(u)),i&&this.extendBean("ext1",encodeURIComponent(i)),r&&this.extendBean("ext2",encodeURIComponent(r)),a&&this.extendBean("ext3",encodeURIComponent(a)),e&&this.lifeCycle.emit("onConfigChange",this.config),this.config},y.use=function(e){-1===y.installedPlugins.indexOf(e)&&e.aegisPlugin&&y.installedPlugins.push(e)},y.unuse=function(e){e=y.installedPlugins.indexOf(e);-1!==e&&y.installedPlugins.splice(e,1)},y.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:x.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(t,E({},e[0]),{level:x.INFO}),this.normalLogPipeline(t)},y.prototype.infoAll=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:x.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(t,E({},e[0]),{level:x.INFO_ALL}),this.normalLogPipeline(t)},y.prototype.report=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:x.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(t,E({},e[0])),this.normalLogPipeline(t)},y.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t={level:x.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(t,E({},e[0]),{level:x.ERROR}),this.normalLogPipeline(t)},y.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},y.prototype.reportPv=function(t){var o,i=this;t&&(console.warn("reportPv is deprecated, please use reportEvent"),o=""+Object.getOwnPropertyNames(this.bean).filter(function(e){return"id"!==e}).map(function(e){return e+"="+i.bean[e]}).join("&"),this.sendPipeline([function(e,n){n({url:i.config.url+"/"+t+"?"+o,addBean:!1,type:R.CUSTOM_PV,fail:function(e){"403 forbidden"===e&&i.destroy()}})}],R.CUSTOM_PV)(null))},y.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},y.prototype.reportTime=function(e,n){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof n?n<0||6e4<n?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,n):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},y.prototype.reportT=function(e){var n=e.name,t=e.duration,o=e.ext1,o=void 0===o?"":o,i=e.ext2,i=void 0===i?"":i,r=e.ext3,r=void 0===r?"":r,e=e.from;if("string"==typeof n&&"number"==typeof t&&"string"==typeof o&&"string"==typeof i&&"string"==typeof r){if(!(t<0||6e4<t))return this.submitCustomTime(n,t,o,i,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},y.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},y.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},y.prototype.submitCustomTime=function(e,n,t,o,i,r){this.customTimePipeline({name:e,duration:n,ext1:t||this.config.ext1,ext2:o||this.config.ext2,ext3:i||this.config.ext3,from:r||void 0})},y.prototype.extendBean=function(e,n){this.bean[e]=n},y.prototype.sendPipeline=function(e,n){var t,r=this;return v(u([function(e,n){if("number"!=typeof t.config.random&&(console.warn("random must in [0, 1], default is 1."),t.config.random=1),!t.isHidden||!t.isGetSample)if(t.isGetSample)t.isHidden||n(e);else{if(t.isGetSample=!0,Math.random()<t.config.random)return t.isHidden=!1,n(e);t.isHidden=!0}},K(t=this,n)],e,[Y(this),function(o,i){r.request(o,function(){for(var e,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];r.failRequestCount=0,i({isErr:!1,result:n,logType:null==o?void 0:o.type,logs:null==o?void 0:o.log}),null!=(e=null==o?void 0:o.success)&&e.call.apply(e,u([o],n))},function(){for(var e,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];10<=++r.failRequestCount&&r.destroy(),i({isErr:!0,result:n,logType:null==o?void 0:o.type,logs:null==o?void 0:o.log}),null!=(e=null==o?void 0:o.fail)&&e.call.apply(e,u([o],n))})},Q(this)]))},y.prototype.send=function(e,i,r){var n=this;return v([Y(this),function(t,o){n.request(t,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];o({isErr:!1,result:e,logType:t.type,logs:t.log}),null!=i&&i.apply(void 0,e)},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];o({isErr:!0,result:e,logType:t.type,logs:t.log}),null!=r&&r.apply(void 0,e)})},Q(this)])(e)},y.prototype.ready=function(e,n,t){throw new Error('You need to override "ready" method')},y.prototype.request=function(e,n,t){throw new Error('You need to override "request" method')},y.prototype.sendSDKError=function(e){var t=this;this.sendPipeline([function(e,n){n({url:t.config.url+"?id=1085&msg[0]="+encodeURIComponent(S(e))+"&level[0]=2&from="+t.config.id+"&count=1&version="+t.config.id+"(1.36.5)",addBean:!1,method:"get",type:R.SDK_ERROR,log:e})}],R.SDK_ERROR)(e)},y.prototype.destroy=function(e){void 0===e&&(e=!1);var n,t,o=y.instances.indexOf(this);-1!==o&&y.instances.splice(o,1);for(var i=y.installedPlugins.length-1;0<=i;i--)try{y.installedPlugins[i].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)n=this,t=Object.getOwnPropertyDescriptors(n),Object.keys(t).forEach(function(e){t[e].writable&&(n[e]=null)}),Object.setPrototypeOf(this,null);else{for(var r=this;r.constructor!==Object&&z(r,this),r=Object.getPrototypeOf(r););0===y.instances.length&&(o=Object.getPrototypeOf(this).constructor,z(o),z(y))}},y.version="1.36.5",y.instances=[],y.logType=x,y.environment=l,y.installedPlugins=[],y),t=(o.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},o.prototype.unpatch=function(e){e=this.instances.indexOf(e);-1!==e&&(this.instances.splice(e,1),0===this.instances.length&&this.uninstall())},o.prototype.countInstance=function(){return this.instances.length},o.prototype.uninstall=function(){var e;null!=(e=null==(e=this.option)?void 0:e.destroy)&&e.apply(this)},o.prototype.walk=function(t){var o=this;this.instances.forEach(function(e){var n=o.canUse(e);n&&t(e,n)})},o.prototype.canUse=function(e){e=this.getConfig(e);return!(!e||"object"!=typeof e)||!!e},o.prototype.getConfig=function(e){return null==(e=e.config)?void 0:e[this.name]},o.prototype.exist=function(e){return-1===this.instances.indexOf(e)},o.prototype.triggerInit=function(e){var n;this.inited||(this.inited=!0,null!=(n=null==(n=this.option)?void 0:n.init)&&n.call(this.option,this.getConfig(e)))},o.prototype.triggerOnNewAegis=function(e){var n;null!=(n=null==(n=this.option)?void 0:n.onNewAegis)&&n.call(this.option,e,this.getConfig(e))},o);function o(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function y(e){var t,n,o,i,a,r,s,u,c,l,f,d,p,h,g,m=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:5,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,onClose:!0,hostUrl:"https://aegis.qq.com",websocketHack:!1,env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:"",setDataReportUrl:"",reportImmediately:!0},this.isWhiteList=!1,this.lifeCycle=new M,this.bean={},this.normalLogPipeline=v([$(this,5),J,function(e,n){var o=t.config;n(e=e.map(function(e){var n,t=o.maxLength||102400;try{if(!e.msg||e.msg.length<=t)return e;e.msg=null==(n=e.msg)?void 0:n.substring(0,t)}catch(n){e.msg=S(e.msg).substring(0,o.maxLength)}return e}))},(h=(t=this).config,g={},function(e,n){var t="number"==typeof h.repeat?h.repeat:5;if(0===t)return n(e);n(e.filter(function(e){return e.level!==x.ERROR&&e.level!==x.PROMISE_ERROR&&e.level!==x.AJAX_ERROR&&e.level!==x.SCRIPT_ERROR&&e.level!==x.IMAGE_ERROR&&e.level!==x.CSS_ERROR&&e.level!==x.MEDIA_ERROR||(g[e.msg]=g[e.msg]||0,g[e.msg]+=1,!(g[e.msg]>t))}))}),(d=this.lifeCycle.emit,p=this.config,function(e,n){var t,o=p.logCreated;return"function"==typeof o?(t=e.filter(function(e){return!1!==o(e)}),d("beforeWrite",t),n(t)):(d("beforeWrite",e),n(e))}),(f=this,setTimeout(function(){var e=f.config.pvUrl,t=void 0===e?"":e;t&&f.sendPipeline([function(e,n){n({url:t,type:R.PV,fail:function(e){"403 forbidden"===e&&f.destroy()}})}],R.PV)(null)},100),function(e,n){n(e)}),(c=u=s=!1,l=[],(a=this).lifeCycle.on("onConfigChange",function(){r&&clearTimeout(r),r=setTimeout(function(){var e,t;!c&&a.config&&(c=!0,e=a.config.whiteListUrl,(t=void 0===e?"":e)&&a.sendPipeline([function(e,n){n({url:t,type:R.WHITE_LIST,success:function(e){u=!0;try{var n=e.data||JSON.parse(e),t=n.retcode,o=n.result,i=void 0===o?{}:o;if(0===t){if(s=i.is_in_white_list,a.isWhiteList=s,i.shutdown)return void a.destroy();0<=i.rate&&i.rate<=1&&(a.config.random=i.rate,a.isGetSample=!1)}a.isWhiteList&&l.length?le(a)(l.splice(0),function(){}):!a.isWhiteList&&l.length&&(l.length=0);var r=a.config.onWhitelist;"function"==typeof r&&r(s)}catch(e){}},fail:function(e){"403 forbidden"===e&&a.destroy(),u=!0}})}],R.WHITE_LIST)(null),c=!1)},a.config.uin?50:500)}),a.lifeCycle.on("destroy",function(){l.length=0}),function(e,n){var t;s||null!=(t=null==(t=a.config)?void 0:t.api)&&t.reportRequest?n(e.concat(l.splice(0)).map(function(e){return ue(e),e})):(t=e.filter(function(e){return e.level!==x.INFO&&e.level!==x.API_RESPONSE?(ue(e),!0):(u||(l.push(e),200<=l.length&&(l.length=200)),!1)})).length&&n(t)}),function(e,n){try{var t=JSON.parse(JSON.stringify(e)),o=(m.lifeCycle.emit("beforeReport",t),m.config.beforeReport);(e="function"==typeof o?e.filter(function(e){return!1!==o(e)}):e).length&&n(e)}catch(e){}},le(this)]),this.eventPipeline=v([$(this,10),(i=this,function(e){i.sendPipeline([function(e,n){var t=e.map(function(e){return{name:e.name,ext1:e.ext1||i.config.ext1||"",ext2:e.ext2||i.config.ext2||"",ext3:e.ext3||i.config.ext3||""}});n({url:i.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(t)),type:R.EVENT,log:e,fail:function(e){"403 forbidden"===e&&i.destroy()}})}],R.EVENT)(e)})]),this.timeMap={},this.failRequestCount=0,this.customTimePipeline=v([$(this,10),(o=this,function(e){return o.sendPipeline([function(e,n){n({url:o.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:R.CUSTOM,log:e,fail:function(e){"403 forbidden"===e&&o.destroy()}})}],R.CUSTOM)(e)})]),this.config=(n=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),n.url=n.url||e+"/collect",n.offlineUrl=n.offlineUrl||e+"/offline",n.whiteListUrl=n.whiteListUrl||e+"/collect/whitelist",n.pvUrl=n.pvUrl||e+"/collect/pv",n.eventUrl=n.eventUrl||e+"/collect/events",n.speedUrl=n.speedUrl||e+"/speed",n.customTimeUrl=n.customTimeUrl||e+"/speed/custom",n.performanceUrl=n.performanceUrl||e+"/speed/performance",n.webVitalsUrl=n.webVitalsUrl||e+"/speed/webvitals",n.setDataReportUrl=n.SetDataReportUrl||e+"/speed/miniProgramData",n),y.instances.push(this)}new t({name:"aid",aid:"",init:function(e){try{var n=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");n||(n=V(),window.localStorage.setItem("AEGIS_ID",n)),this.aid=n}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}});function de(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function pe(n,t){function o(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(n(e),t&&(removeEventListener("visibilitychange",o,!0),removeEventListener("pagehide",o,!0)))}addEventListener("visibilitychange",o,!0),addEventListener("pagehide",o,!0)}function he(n){return ge.some(function(e){return-1<n.indexOf(e)})}function i(e){return-1!==we.indexOf(e)}var ge=["/collect/offlineAuto","/aegis-sdk","/flog.core.min.js"],me=function(n){var t;return n.payload?(t={},Object.keys(n).forEach(function(e){"payload"!==e&&(t[e]=n[e])}),t):n},ve=new t({name:"reportAssetSpeed"}),ye=ve=new t({name:"reportAssetSpeed",collectCur:0,collectEntryType:"resource",ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var n=this;de()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){n.collectCur=0,performance.clearResourceTimings()})},publish:function(n){this.$walk(function(e){e.speedLogPipeline(n)})},publishMany:function(e,n){for(var t=n.config,o=0,i=e.length;o<i;o++){var r=e[o];-1===this.ASSETS_INITIATOR_TYPE.indexOf(r.initiatorType)||he(r.name)||this.publish(this.generateLog(r,t))}},collectSuccessLog:function(t){var e,n,o=this;"function"==typeof window.PerformanceObserver?(this.publishMany(performance.getEntriesByType(this.collectEntryType),t),(e=new window.PerformanceObserver(function(e){o.publishMany(e.getEntries(),t)})).observe({entryTypes:[this.collectEntryType]}),t.lifeCycle.on("destroy",function(){0===ve.countInstance()&&e.disconnect()})):(n=setInterval(function(){var e=performance.getEntriesByType(o.collectEntryType),n=e.slice(o.collectCur);o.collectCur=e.length,o.publishMany(n,t)},3e3),t.lifeCycle.on("destroy",function(){0===ve.countInstance()&&clearInterval(n)}))},collectFailLog:function(e){function n(e){var n,t;e&&(e=e.target||e.srcElement,!(n=(null==e?void 0:e.src)||(null==e?void 0:e.href))||"string"!=typeof n||-1<window.location.href.indexOf(n)||(e="function"==typeof(null==(e=i.api)?void 0:e.resourceTypeHandler)?null==(e=i.api)?void 0:e.resourceTypeHandler(n):"",t=performance.getEntriesByType(o.collectEntryType).find(function(e){return e.name===n}),he(n)||(t={url:P(n),status:400,duration:Number(((null==t?void 0:t.duration)||0).toFixed(2)),method:"get",type:e||"static",isHttps:C(n),urlQuery:P(n,!0),nextHopProtocol:"",domainLookup:0,connectTime:0},o.publish(t))))}var o=this,i=e.config;window.document.addEventListener("error",n,!0),e.lifeCycle.on("destroy",function(){0===ve.countInstance()&&window.document.removeEventListener("error",n,!0)})},generateLog:function(e,n){var t,n="function"==typeof(null==(t=n.api)?void 0:t.resourceTypeHandler)?null==(t=n.api)?void 0:t.resourceTypeHandler(e.name):"";return{url:P(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:n||"static",isHttps:C(e.name),nextHopProtocol:e.nextHopProtocol||"",urlQuery:P(e.name,!0),domainLookup:G(e.domainLookupEnd-e.domainLookupStart),connectTime:G(e.connectEnd-e.connectStart)}},collectNotReportedLog:function(e){var n,t;de()&&(n=(t=performance.getEntriesByType(this.collectEntryType)).length,"function"!=typeof window.PerformanceObserver&&this.collectCur!==n&&(t=t.slice(this.collectCur),this.collectCur=n,this.publishMany(t,e,!0)))},destroy:function(){this.option.publish=function(){}}}),we=window.navigator.userAgent.toLowerCase(),r={};r.macos=function(){return i("mac")},r.ios=function(){return r.iphone()||r.ipod()||r.ipad()},r.iphone=function(){return!r.windows()&&i("iphone")},r.ipod=function(){return i("ipod")},r.ipad=function(){var e="MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;return i("ipad")||e},r.android=function(){return!r.windows()&&i("android")},r.androidPhone=function(){return r.android()&&i("mobile")},r.androidTablet=function(){return r.android()&&!i("mobile")},r.blackberry=function(){return i("blackberry")||i("bb10")},r.blackberryPhone=function(){return r.blackberry()&&!i("tablet")},r.blackberryTablet=function(){return r.blackberry()&&i("tablet")},r.windows=function(){return i("windows")},r.windowsPhone=function(){return r.windows()&&i("phone")},r.windowsTablet=function(){return r.windows()&&i("touch")&&!r.windowsPhone()},r.fxos=function(){return(i("(mobile")||i("(tablet"))&&i(" rv:")},r.fxosPhone=function(){return r.fxos()&&i("mobile")},r.fxosTablet=function(){return r.fxos()&&i("tablet")},r.meego=function(){return i("meego")},r.cordova=function(){return window.cordova&&"file:"===location.protocol},r.nodeWebkit=function(){return"object"==typeof window.process},r.mobile=function(){return r.androidPhone()||r.iphone()||r.ipod()||r.windowsPhone()||r.blackberryPhone()||r.fxosPhone()||r.meego()},r.tablet=function(){return r.ipad()||r.androidTablet()||r.blackberryTablet()||r.windowsTablet()||r.fxosTablet()},r.desktop=function(){return!r.tablet()&&!r.mobile()};function be(n){s.find(function(e){return e.name===n.name})||(s.push(n),!Pe&&window.XMLHttpRequest&&(Pe=!0,window.XMLHttpRequest.prototype.open=function(){if(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1],this.aegisXhrStartTime=Date.now(),this.sendByAegis)r.isIE()||(this.timeout=5e3);else for(var e=0;e<s.length;e++){var n=s[e];try{"function"==typeof n.open&&n.open(this)}catch(e){}}return Le.apply(this,arguments)},window.XMLHttpRequest.prototype.setRequestHeader=function(){var e=arguments[0],n=arguments[1];return this.aegisXhrReqHeader=this.aegisXhrReqHeader||{},this.aegisXhrReqHeader[e]=n,xe.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<s.length;e++){var n=s[e];try{"function"==typeof n.send&&n.send(this,arguments[0])}catch(e){}}return Ce.apply(this,arguments)}))}function Ee(n){var e=s.findIndex(function(e){return e.name===n.name});-1!==e&&s.splice(e,1),window.XMLHttpRequest.prototype.send=Ce,window.XMLHttpRequest.prototype.open=Le,window.XMLHttpRequest.prototype.setRequestHeader=xe}function Re(e){return e.split("\r\n").reduce(function(e,n){n=n.split(": ");return n[0]&&n[1]&&(e[n[0]]=n[1]),e},{})}function k(o,e,i){return null!=e&&e.length&&"object"==typeof o?e.reduce(function(e,n){var t=o instanceof Headers?o.get(n):o[n];return t?e+(""===e?"\n":"\n\n")+i+" header "+n+": "+t:e},""):""}function Se(e){var n,t="";return"object"==typeof e&&(n=(e=function(e,n){for(var t=0;t<n.length;t++){var o=n[t],i=e[o]||"function"==typeof e.get&&e.get(o);if(i)return[o,i]}return["",""]}(e,Object.keys(Ae)))[0],e=e[1],n&&(t=Ae[n](e))),t}var a,Oe,Te,Pe=!(r.isIE=function(){return"ActiveXObject"in window}),s=[],Ce=window.XMLHttpRequest.prototype.send,Le=window.XMLHttpRequest.prototype.open,xe=window.XMLHttpRequest.prototype.setRequestHeader,ke=window.fetch,Ie=!1,c=[],Ae={sw8:function(e){e=e.split("-")[1];return e?atob(e):""},traceparent:function(e){return e.split("-")[1]},"sentry-trace":function(e){return e.split("-")[0]}},Ne=(new t({name:"reportApiSpeed"}),new t({name:"reportApiSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideFetch(e.config),this.overrideXhr(e.config))},getRequestType:function(e,n,t){void 0===n&&(n="");var o,i,e="function"==typeof(null==(i=e.api)?void 0:i.resourceTypeHandler)?null==(i=e.api)?void 0:i.resourceTypeHandler(t):"";return"fetch"===e&&"static"===e||(o=void 0===n?"":n,i=(void 0===t?"":t).split("?")[0],e=ee.test(i)||Z.some(function(e){return-1!==String(o).indexOf(e)})?"static":"fetch"),e},overrideFetch:function(h){var g=this,e={name:this.name,then:function(c,l,f,d){var e,p;h.hostUrl&&-1<f.indexOf(h.hostUrl)||(e=c.headers?c.headers.get("content-type"):"",e=g.getRequestType(h,e,c.url),p={url:c.url,isHttps:C(c.url),method:(null==d?void 0:d.method)||"get",duration:l,type:e,nextHopProtocol:"",status:c.status||0},"fetch"===e?c.clone().text().then(function(e){var n=c.status<=0||400<=c.status,t=(null==(t=h.api)?void 0:t.reqHeaders)||[],t=k(null==d?void 0:d.headers,t,"req"),o=(null==(o=h.api)?void 0:o.resHeaders)||[],o=k(c.headers,o,"res"),i=Se(null==d?void 0:d.headers),r=X(e,h.api,{url:f,ctx:c,payload:null==d?void 0:d.body}),a=r.code,r=r.isErr,s=null==(s=h.api)?void 0:s.apiDetail,u=s?L(null==d?void 0:d.body,null==(u=h.api)?void 0:u.reqParamHandler,{url:f}):"",s=s?L(e,null==(s=h.api)?void 0:s.resBodyHandler,{url:f,ctx:c}):"",e=(n?"FETCH_ERROR: "+e+" \n\n":"")+"fetch req url: "+f+" \n                                \nres status: "+(c.status||0)+" \n                                \nres duration: "+l+"ms \n                                \nreq method: "+((null==d?void 0:d.method)||"get")+" \n                                \nres retcode: "+a+"\n                                \nreq param: "+u+"\n                                \nres data: "+s+"\n                                "+t+"\n                                "+o;p.payload=null==d?void 0:d.body,p.ret=a,p.isErr=+r,g.publishNormalLog({msg:e,level:n?x.AJAX_ERROR:r?x.RET_ERROR:x.API_RESPONSE,code:a,trace:i}),g.publishSpeed(p)}):(Object.assign(p,{type:"static",urlQuery:P(c.url,!0),domainLookup:T.number,connectTime:T.number}),g.publishSpeed(p)))},catch:function(e,n,t,o){var i,r,a;if(!(h.hostUrl&&-1<t.indexOf(h.hostUrl)))throw i=g.getRequestType(h,"",t),i={url:t,isHttps:C(t),method:(null==o?void 0:o.method)||"get",duration:n,nextHopProtocol:"",type:i,status:0},g.publishSpeed(i),i=(null==(i=h.api)?void 0:i.reqHeaders)||[],i=k(null==o?void 0:o.headers,i,"req"),r=Se(null==o?void 0:o.headers),a=null!=(a=h.api)&&a.apiDetail?L(null==o?void 0:o.body,null==(a=h.api)?void 0:a.reqParamHandler,{url:t}):"",t="AJAX_ERROR: "+e+"\n                          \nreq url: "+t+"\n                          \nres status: 0\n                          \nres duration: "+n+"ms\n                          \nreq method: "+((null==o?void 0:o.method)||"get")+"\n                          \nreq param:"+a+"\n                          "+i,g.publishNormalLog({msg:t,level:x.AJAX_ERROR,code:-400,trace:r}),e}},n=(this.hackFetchOptions=e,this.hackFetchOptions);if(c.find(function(e){return e.name===n.name}))throw new Error("name '"+n.name+"' is already in hackFetch option list");c.push(n),!Ie&&window.fetch&&(Ie=!0,window.fetch=function(e,o){void 0===o&&(o={});for(var i="string"==typeof e?e:e.url,n=0;n<c.length;n++){var t=c[n];try{"function"==typeof t.beforeFetch&&t.beforeFetch(i,o)}catch(e){}}var r=Date.now();return ke(e,o).then(function(e){for(var n=0;n<c.length;n++){var t=c[n];try{"function"==typeof t.then&&t.then(e,Date.now()-r,i,o)}catch(e){}}return e}).catch(function(e){for(var n=0;n<c.length;n++){var t=c[n];try{"function"==typeof t.catch&&t.catch(e,Date.now()-r,i,o)}catch(e){}}throw e})})},overrideXhr:function(S){var O=this,e={name:this.name,send:function(b,E){var R=Date.now();b.addEventListener("loadend",function(){var o=b.aegisUrl||"";if(o&&!(S.hostUrl&&-1<o.indexOf(S.hostUrl))){var i=Date.now()-R,e=b.getResponseHeader("content-type"),e=O.getRequestType(S,e,o),r={url:o,isHttps:C(o),status:b.status||0,method:b.aegisMethod||"get",type:e,nextHopProtocol:"",duration:i},n=(null==(n=S.api)?void 0:n.reqHeaders)||[],a=k(b.aegisXhrReqHeader,n,"req"),n=(null==(n=S.api)?void 0:n.resHeaders)||[],t=Re(b.getAllResponseHeaders()),s=k(t,n,"res"),u=Se(b.aegisXhrReqHeader),n=null==(t=S.api)?void 0:t.apiDetail,c=n?L(E,null==(t=S.api)?void 0:t.reqParamHandler,{url:o}):"",l=n?L(b.response,null==(t=S.api)?void 0:t.resBodyHandler,{url:o}):"";if("fetch"===e)try{var f,d,p,h,g=b.response,m=S.api,v={url:o,ctx:b,payload:E},y=function(e){var n=e.code,e=e.isErr,t="xhr req url: "+o+"\n                    \nres status: "+r.status+"\n                    \nres duration: "+i+"ms\n                    \nreq method: "+r.method+"\n                    \nres retcode: "+n+"\n                    \nreq param: "+c+"\n                    \nres data: "+l+"\n                    "+a+"\n                    "+s;r.ret=n,r.isErr=+e,r.payload=E,O.publishNormalLog({msg:t,level:e?x.RET_ERROR:x.API_RESPONSE,code:n,trace:u}),O.publishSpeed(r)};try{if("function"==typeof(null==m?void 0:m.retCodeHandlerAsync))return void m.retCodeHandlerAsync(g,null==v?void 0:v.url,null==v?void 0:v.ctx,function(e){var n=e.code,e=e.isErr;null!=y&&y({code:void 0===n?"unknown":n,isErr:e})});if("function"==typeof(null==m?void 0:m.retCodeHandler))return void(p=(d=m.retCodeHandler(g,null==v?void 0:v.url,null==v?void 0:v.ctx,null==v?void 0:v.payload)||{}).code,h=d.isErr,null!=y&&y({code:void 0===p?"unknown":p,isErr:h}));"string"==typeof g&&(g=JSON.parse(g)),"function"==typeof(null==(f=null==m?void 0:m.ret)?void 0:f.join)&&(ne=[].concat(m.ret.map(function(e){return e.toLowerCase()})));var w=Object.getOwnPropertyNames(g).filter(function(e){return-1!==ne.indexOf(e.toLowerCase())});if(w.length)return void(p=g[w[0]],null!=y&&y({code:""+p,isErr:0!==p&&"0"!==p}));null!=y&&y({code:"unknown",isErr:!1})}catch(g){null!=y&&y({code:"unknown",isErr:!1})}}catch(e){r.ret="unknown",O.publishSpeed(r)}else Object.assign(r,{type:"static",urlQuery:P(o,!0),domainLookup:T.number,connectTime:T.number}),O.publishSpeed(r)}})}};this.hackXHROptions=e,be(this.hackXHROptions)},publishSpeed:function(t){var o=this;this.$walk(function(e){var n=o.$getConfig(e);"fetch"===t.type&&n&&"function"==typeof n.urlHandler?e.speedLogPipeline(E(E({},t),{url:P(n.urlHandler(t.url,t.payload))})):(t.url=P(t.url),e.speedLogPipeline(t))})},publishNormalLog:function(n){this.$walk(function(e){e.normalLogPipeline(n)})},destroy:function(){var n,e;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&Ee(this.option.hackXHROptions),this.option.hackFetchOptions&&(n=this.option.hackFetchOptions,-1!==(e=c.findIndex(function(e){return e.name===n.name}))&&c.splice(e,1),window.fetch=ke)}})),He=new t({name:"reportBridgeSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideBridge(e))},publishSpeed:function(n){this.$walk(function(e){e.speedLogPipeline(n)})},overrideBridge:function(e){var s=this,u=Date.now(),c=e.config;c.reportBridgeSpeed&&c.h5Bridge&&c.h5BridgeFunc.length&&c.h5BridgeFunc.forEach(function(e){var a=c.h5Bridge[e];c.h5Bridge[e]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=e[0],i=e[1],t=e[2],r=e[3];a(o,i,t,function(e){var n=X(e,c.api),t=n.code,n=n.isErr,t={url:o+"-"+i,name:o+"-"+i,duration:Date.now()-u,type:"bridge",ret:t,isErr:+n};s.publishSpeed(t),r(e)})}})}});(m=a=a||{})[m.unknown=100]="unknown",m[m.wifi=1]="wifi",m[m.net2g=2]="net2g",m[m.net3g=3]="net3g",m[m.net4g=4]="net4g",m[m.net5g=5]="net5g",m[m.net6g=6]="net6g",(m=Oe=Oe||{})[m.android=1]="android",m[m.ios=2]="ios",m[m.windows=3]="windows",m[m.macos=4]="macos",m[m.linux=5]="linux",m[m.other=100]="other",(m=Te=Te||{})[m.unknown=100]="unknown",m[m.normal=0]="normal",m[m.weak=1]="weak",m[m.disconnected=2]="disconnected";function f(e,n,t,o){return void 0===t&&(t=3e4),void 0===o&&(o=0),(n=void 0===n?0:n)<=e&&e<=t?e:o}var d,p,h,je,_e,g,Ue,qe,Be,m=new t({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",a.unknown),this.getDpi(e),this.refreshNetworkTypeToBean(e),this.refreshNetworkStatusToBean(e)},getDpi:function(e){e.extendBean("vp",Math.round(window.innerWidth)+" * "+Math.round(window.innerHeight)),window.screen&&e.extendBean("sr",Math.round(window.screen.width)+" * "+Math.round(window.screen.height))},getPlatform:function(){var n={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},e=Object.keys(n).find(function(e){return n[e].test(navigator.userAgent)});return e?Oe[e]:Oe.other},refreshNetworkTypeToBean:function(n){var t=this,e=n.config;e&&("function"==typeof e.getNetworkType?e.getNetworkType:De)(function(e){a[e]||(e=a.unknown),n.extendBean("netType",e),t.NetworkRefreshTimer=setTimeout(function(){t.refreshNetworkTypeToBean(n),clearTimeout(t.NetworkRefreshTimer)},1e4)})},refreshNetworkStatusToBean:function(n){var e,t=this,o=n.config;!o||null!=(e="function"==typeof o.getNetworkStatus?o.getNetworkStatus:e)&&e(function(e){void 0===Te[e]&&(e=Te.unknown),n.extendBean("netStatus",e),t.NetworkStatusRefreshTimer=setTimeout(function(){t.refreshNetworkStatusToBean(n),clearTimeout(t.NetworkStatusRefreshTimer)},1e4)})}}),De=function(e){var n="",t=navigator.userAgent.match(/NetType\/(\w+)/);t?n=t[1]:navigator.connection&&(n=navigator.connection.effectiveType||navigator.connection.type),e((t=n=n||"unknown",0<=(t=String(t).toLowerCase()).indexOf("4g")?a.net4g:0<=t.indexOf("wifi")?a.wifi:0<=t.indexOf("5g")?a.net5g:0<=t.indexOf("6g")?a.net6g:0<=t.indexOf("3g")?a.net3g:0<=t.indexOf("2g")?a.net2g:a.unknown))},Fe=window.WebSocket,w=[],Me={construct:function(e,n){var a=new e(n[0],n[1]);return a.originSend=a.send,a.addEventListener("error",function(e){var e=(null==e?void 0:e.currentTarget)||{},n=e.url,t=e.readyState;null!=w&&w.forEach(function(e){e=e.onErr;null!=e&&e({msg:"无法获知具体错误信息，需在浏览器控制台查看！",readyState:t,connectUrl:n})})}),Object.defineProperty(a,"send",{get:function(){return function(e){null!=(n=a.originSend)&&n.call(a,e);var n=a.readyState,e=WebSocket.OPEN,t=WebSocket.CLOSED,o=WebSocket.CONNECTING,i=WebSocket.CLOSING;if(n!==e){var r={readyState:n,connectUrl:a.url};switch(n){case t:w.forEach(function(e){e=e.sendErr;null!=e&&e(E({msg:"消息发送失败，连接已关闭！"},r))});break;case o:w.forEach(function(e){(0,e.sendErr)(E({msg:"消息发送失败，正在连接中！"},r))});break;case i:w.forEach(function(e){(0,e.sendErr)(E({msg:"消息发送失败，连接正在关闭！"},r))})}}}}}),a}},We=new t({name:"onError"}),Ge=We=new t({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(l){function e(e){e=e&&S(e.reason),r.publishErrorLog({msg:"PROMISE_ERROR: "+e,level:x.PROMISE_ERROR})}function n(e){if(e=(null==e?void 0:e.target)||(null==e?void 0:e.srcElement)){var n=e.src||e.href,e=e.tagName;if("string"==typeof n&&e&&!(-1<window.location.href.indexOf(n))){var t={msg:e+" load fail: "+n,level:x.INFO};if(/\.js$/.test(n))t.level=x.SCRIPT_ERROR;else if(/\.css$/.test(n))t.level=x.CSS_ERROR;else switch(e.toLowerCase()){case"script":t.level=x.SCRIPT_ERROR;break;case"link":t.level=x.CSS_ERROR;break;case"img":t.level=x.IMAGE_ERROR;break;case"audio":case"video":t.level=x.MEDIA_ERROR;break;default:return}r.publishErrorLog(t)}}}var t,o,i,r=this,a=window.onerror,f=(window.onerror=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];r.publishErrorLog({msg:(S(e[0])||"")+" @ ("+(S(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+S(e[4]||""),level:x.ERROR}),null!=a&&a.call.apply(a,u([window],e))},window.addEventListener("unhandledrejection",e),window.document.addEventListener("error",n,!0),l.lifeCycle.on("destroy",function(){0===We.countInstance()&&(window.document.removeEventListener("unhandledrejection",e),window.document.removeEventListener("error",n,!0))}),this),s={name:this.name,send:function(u,c){u.addEventListener("loadend",function(){var e,n,t,o,i,r,a,s="";this.failType?s=this.failType:this.status?400<=this.status&&(s="error"):s="failed",l.config.hostUrl&&this.aegisUrl&&-1<this.aegisUrl.indexOf(l.config.hostUrl)||!s||(e=u.aegisUrl,n=(null==(n=l.config.api)?void 0:n.reqHeaders)||[],n=k(u.aegisXhrReqHeader,n,"req"),o=(null==(o=l.config.api)?void 0:o.resHeaders)||[],t=Re(u.getAllResponseHeaders()),t=k(t,o,"res"),o=Se(u.aegisXhrReqHeader),i=X(u.response,l.config.api,{url:e,ctx:u,payload:c}).code,r=(a=null==(a=l.config.api)?void 0:a.apiDetail)?L(c,null==(r=l.config.api)?void 0:r.reqParamHandler,{url:e}):"",a=a?L(u.responseType&&"text"!==u.responseType&&"json"!==u.responseType?"":ie(u.response),null==(a=l.config.api)?void 0:a.resBodyHandler,{url:e}):"",f.publishErrorLog({msg:"AJAX_ERROR: request "+s+"\n                      \nreq url: "+this.aegisUrl+"\n                      \nres status: "+(this.status||0)+"\n                      \nres duration: "+(Date.now()-u.aegisXhrStartTime)+"ms\n                      \nres retcode: "+i+"\n                      \nreq method: "+this.aegisMethod+"\n                      \nreq param: "+r+"\n                      \nres data: "+a+"\n                      "+n+"\n                      "+t,level:x.AJAX_ERROR,trace:o}))}),u.addEventListener("timeout",function(){u.failType="timeout"}),u.addEventListener("error",function(){u.failType="error"}),u.addEventListener("abort",function(){u.failType="abort"})}};this.hackXHROptions=s,be(this.hackXHROptions),l.config.websocketHack&&(s={key:l.config.id+"-"+this.name,onErr:function(e){var n;null!=(n=r.publishWsErrorLog)&&n.call(r,e)},sendErr:function(e){var n;null!=(n=r.publishWsErrorLog)&&n.call(r,e)}},this.hackWebsocketConfig=s,s=this.hackWebsocketConfig,window.Proxy&&window.WebSocket&&(t=window.WebSocket,window&&!t.isHack&&(o=new Proxy(WebSocket,Me),t.isHack=!0,window.WebSocket=o),i=s,w.find(function(e){return e.key===i.key})||i&&w.push(i)))},publishErrorLog:function(n){this.$walk(function(e){e.normalLogPipeline(n)})},publishWsErrorLog:function(e){var n=e.connectUrl,t=e.msg,e=e.readyState;this.publishErrorLog({msg:"WEBSOCKET_ERROR: \n              connect: "+n+"\n              readyState: "+e+"\n              msg: "+t,level:x.WEBSOCKET_ERROR})},destroy:function(){var n,e;this.option.publishErrorLog=function(){},this.option.hackXHROptions&&Ee(this.option.hackXHROptions),this.option.hackWebsocketConfig&&(n=this.option.hackWebsocketConfig,window.WebSocket=Fe,-1!==(e=w.findIndex(function(e){return e.key===n.key}))&&w.splice(e,1))}}),Xe=(new t({name:"pagePerformance"}),3),Ve=new t({name:"pagePerformance",onNewAegis:function(e){de()&&(d?this.publish(d,e):this.startCalcPerformance(e))},publish:function(e,a){var s=this;a.sendPipeline([function(e,n){var t,o=[];for(t in e)o.push(t+"="+e[t]);var i,r=s.$getConfig(a);if(r)return i=-1===a.config.performanceUrl.indexOf("?")?"?":"&","function"==typeof r.urlHandler?n({url:a.config.performanceUrl+i+o.join("&")+"&from="+(encodeURIComponent(r.urlHandler())||window.location.href),beanFilter:["from"],type:R.PERFORMANCE,log:e}):n({url:a.config.performanceUrl+i+o.join("&"),type:R.PERFORMANCE,log:e})}],R.PERFORMANCE)(e)},startCalcPerformance:function(t){var o=this;try{this.getFirstScreenTiming(t,function(e){var n=performance.timing;n&&(d={dnsLookup:f(n.domainLookupEnd-n.domainLookupStart),tcp:f(n.connectEnd-n.connectStart),ssl:f(0===n.secureConnectionStart?0:n.requestStart-n.secureConnectionStart),ttfb:f(n.responseStart-n.requestStart),contentDownload:f(n.responseEnd-n.responseStart),domParse:f(n.domInteractive-n.domLoading,0,3e4,1070),resourceDownload:f(n.loadEventStart-n.domInteractive,0,3e4,1070),firstScreenTiming:f(Math.floor(e),0,6e4)},(n=t.config).extraPerformanceData&&"{}"!==JSON.stringify(n.extraPerformanceData)&&(n=(e=n.extraPerformanceData).engineInit,e=e.bundleLoad,d=E(E({},d),{engineInit:f(n,0,1e4),bundleLoad:f(e,0,1e4)})),o.publish(d,t))})}catch(t){}},getFirstScreenTiming:function(s,u){s.lifeCycle.on("destroy",function(){h&&clearTimeout(h)});var c=this,t=["script","style","link","br"],l=[],f={},d=new MutationObserver(function(e){var n={roots:[],rootsDomNum:[],time:performance.now()};e.forEach(function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach(function(e){1===e.nodeType&&(e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")||e.querySelector("[AEGIS-FIRST-SCREEN-TIMING]"))?(Object.prototype.hasOwnProperty.apply(f,[n.time])||(f[n.time]=[]),f[n.time].push(e)):1!==e.nodeType||-1!==t.indexOf(e.nodeName.toLocaleLowerCase())||c.isEleInArray(e,n.roots)||e.hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(n.roots.push(e),n.rootsDomNum.push(c.walkAndCount(e)||0))})}),n.roots.length&&l.push(n)}),p=(d.observe(document,{childList:!0,subtree:!0}),function(o){(o=void 0===o?0:o)||(i=0,(e=Object.keys(f).filter(function(e){return f[+e].find(function(e){return c.isInFirstScreen(e)})})).length?(o=Math.max.apply(null,e),("object"!=typeof(null==(e=s.config)?void 0:e.pagePerformance)||null!=(e=s.config.pagePerformance)&&e.firstScreenInfo)&&(s.firstScreenInfo={element:null==(e=f[o])?void 0:e[0],timing:o,markDoms:f})):l.forEach(function(e){for(var n,t=0;t<e.roots.length;t++)e.rootsDomNum[t]>i&&c.isInFirstScreen(e.roots[t])&&(i=e.rootsDomNum[t],o=e.time,("object"!=typeof(null==(n=s.config)?void 0:n.pagePerformance)||null!=(n=s.config.pagePerformance)&&n.firstScreenInfo)&&(s.firstScreenInfo={element:e.roots[t],timing:o}))}),l.length=0,Object.keys(f).forEach(function(e){f[e]=f[e].map(function(e){var n={tagName:e.tagName},t=e.attributes;if(!t)return e;for(var o=0;o<t.length;o++){var i=t[o];i.name&&(n[i.name]=e.getAttribute(i.name))}return n})}));var i,e=performance.timing,n=e.domInteractive-e.domLoading,e=e.loadEventStart-e.domInteractive,t=o;h=null;for(var r=0,a=[n,e,t];r<a.length;r++)if(a[r]<=0&&0<Xe){h=setTimeout(function(){return p(t)},3e3);break}h?--Xe:(d.disconnect(),null!=u&&u(o))}),h=setTimeout(function(){return p()},3e3)},isEleInArray:function(e,n){return!(!e||e===document.documentElement)&&(-1!==n.indexOf(e)||this.isEleInArray(e.parentElement,n))},isInFirstScreen:function(e){var n,t;return!(!e||"function"!=typeof e.getBoundingClientRect)&&(e=e.getBoundingClientRect(),n=window.innerHeight,t=window.innerWidth,0<=e.left&&e.left<t&&0<=e.top&&e.top<n&&0<e.width&&0<e.height)},walkAndCount:function(e){var n=0;if(e&&1===e.nodeType){n+=1;var t=e.children;if(null!=t&&t.length)for(var o=0;o<t.length;o++)n+=this.walkAndCount(t[o])}return n}});function $e(){_e=[],h=-1,p=null,Ye(addEventListener)}function Je(e,n){p||(p=n,h=e,je=new Date,Ye(removeEventListener),Ke())}function Ke(){var n;0<=h&&h<je-Ue&&(n={entryType:"first-input",name:p.type,target:p.target,cancelable:p.cancelable,startTime:p.timeStamp,processingStart:p.timeStamp+h},_e.forEach(function(e){e(n)}),_e=[])}function Ye(n){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return n(e,qe,g)})}g={passive:!0,capture:!0},Ue=new Date,qe=function(e){var n,t,o,i;function r(){Je(t,o),i()}function a(){i()}e.cancelable&&(n=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(t=n,o=e,i=function(){removeEventListener("pointerup",r,g),removeEventListener("pointercancel",a,g)},addEventListener("pointerup",r,g),addEventListener("pointercancel",a,g)):Je(n,e))},Be="hidden"===document.visibilityState?0:1/0,addEventListener("visibilitychange",function e(n){"hidden"===document.visibilityState&&(Be=n.timeStamp,removeEventListener("visibilitychange",e,!0))},!0),$e(),self.webVitals={firstInputPolyfill:function(e){_e.push(e),Ke()},resetFirstInputPolyfill:$e,get firstHiddenTime(){return Be}};function I(e,n){return{name:e,value:void 0===n?-1:n,delta:0,entries:[],id:"v1-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}}function Qe(e,n){try{var t;if(PerformanceObserver.supportedEntryTypes.includes(e))if("first-input"!==e||"PerformanceEventTiming"in self)return(t=new PerformanceObserver(function(e){return e.getEntries().map(n)})).observe({type:e,buffered:!0}),t}catch(e){}}function A(n){addEventListener("pageshow",function(e){e.persisted&&n(e)},!0)}function N(e,n,t){var o;return function(){0<=n.value&&(t||H.has(n)||"hidden"===document.visibilityState)&&(n.delta=n.value-(o||0),!n.delta&&void 0!==o||(o=n.value,e(n)))}}function ze(){rn(function(e){e=e.timeStamp;an=e},!0)}function Ze(){return an<0&&((an=self.webVitals.firstHiddenTime)===1/0&&ze(),A(function(){setTimeout(function(){an="hidden"===document.visibilityState?0:1/0,ze()},0)})),{get timeStamp(){return an}}}function en(e){var n=e.name,e=e.value;sn[n]=e}function nn(e,h){function g(e){b=e}function m(e){y=y.concat(e)}function v(e,n){w={conds:e=void 0===e?{}:e,params:n=void 0===n?{}:n}}var y=[],w=null,b=null;O.useAsyncPlugin(e,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",m),e.lifeCycle.on("uploadLogs",v),e.lifeCycle.on("onConfigChange",g)},onAegisInitAndPluginLoaded:function(o,e){var n,t,i,r,a,s,u=h.dbConfig,u=void 0===u?{}:u,c=h.url,c=void 0===c?O.urls.aegisCollect:c,l=h.offlineLogExp,l=void 0===l?3:l,f=h.id,d=h.uin,c=(null!=(n=o.lifeCycle)&&n.remove("beforeWrite",m),null!=(n=o.lifeCycle)&&n.remove("uploadLogs",v),null!=(n=o.lifeCycle)&&n.remove("onConfigChange",g),Object.assign({lookupUrl:c+"/offlineAuto?id="+f,preservedDay:l,id:f,uin:d,aid:(null==(n=o.bean)?void 0:n.aid)||"",beforeRequest:o.config.beforeRequest,afterRequest:o.config.afterRequest},u,{sessionId:O.sessionID}));try{var p=new e(c);y.forEach(function(e){p.add(E(E({},e),{level:e.level===x.INFO_ALL?x.INFO:e.level}))}),null!=(t=o.lifeCycle)&&t.on("beforeWrite",function(e){(e=void 0===e?[]:e).forEach(function(e){p.add(E(E({},e),{level:e.level===x.INFO_ALL?x.INFO:e.level}))})}),null!=(i=o.lifeCycle)&&i.on("uploadLogs",function(e,n){var t;void 0===e&&(e={}),void 0===n&&(n={}),p.uploadLogs(Object.assign({id:h.id,uin:h.uin,aid:null==(t=o.bean)?void 0:t.aid},e),n)}),null!=(r=o.lifeCycle)&&r.on("onConfigChange",function(e){p.setConfig(e)}),null!=(a=o.lifeCycle)&&a.on("destroy",function(){0===ln.countInstance()&&(y.length=0,"function"==typeof((w=null)==p?void 0:p.destroy)&&p.destroy())}),p.on("PERREVENT",function(e){o.sendPipeline([function(e,n){t={msg:S(e),level:x.INFO};var t=(t=Array.isArray(t)?t:[t]).map(function(n,t){return Object.getOwnPropertyNames(n).map(function(e){return D(e)+"["+t+"]="+(void 0===n[e]?"":D(n[e]))}).join("&")}).join("&")+(t.length?"&count="+t.length:"");n({type:R.OFFLINE,data:t,contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:h.url+"?id=893&sessionId="+O.sessionID+"&uin="+h.uin+"&from="+h.id+"&count=1&version=1.36.5",log:e})}],R.OFFLINE)(e)}),b&&(p.setConfig(b),b=null),w&&(null!=(s=o.lifeCycle)&&s.emit("uploadLogs",w.conds,w.params),w=null),o.flog=p}catch(o){console.log(o)}}})}var tn,on,rn=function(n,t){function o(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(n(e),t&&(removeEventListener("visibilitychange",o,!0),removeEventListener("pagehide",o,!0)))}addEventListener("visibilitychange",o,!0),addEventListener("pagehide",o,!0)},H=new("function"==typeof WeakSet?WeakSet:Set),an=-1,sn=(new t({name:"webVitals"}),{FCP:-1,LCP:-1,FID:-1,CLS:-1}),un=new t({name:"webVitals",onNewAegis:function(e){if(de()&&"function"==typeof window.PerformanceObserver&&"function"==typeof performance.getEntriesByName)try{v=en,w=Ze(),b=I("FCP"),E=performance.getEntriesByName("first-contentful-paint")[0],R=E?null:Qe("paint",T),(E||R)&&(y=N(v,b,void 0),E&&T(E),A(function(e){b=I("FCP"),y=N(v,b,void 0),requestAnimationFrame(function(){requestAnimationFrame(function(){b.value=performance.now()-e.timeStamp,H.add(b),y()})})})),f=en,h=Ze(),g=I("LCP"),(m=Qe("largest-contentful-paint",O))&&(d=N(f,g,void 0),p=function(){H.has(g)||(m.takeRecords().map(O),m.disconnect(),H.add(g),d())},["keydown","click"].forEach(function(e){addEventListener(e,p,{once:!0,capture:!0})}),rn(p,!0),A(function(e){g=I("LCP"),d=N(f,g,void 0),requestAnimationFrame(function(){requestAnimationFrame(function(){g.value=performance.now()-e.timeStamp,H.add(g),d()})})})),a=en,s=Ze(),u=I("FID"),c=Qe("first-input",S),l=N(a,u,void 0),c&&rn(function(){c.takeRecords().map(S),c.disconnect()},!0),c||window.webVitals.firstInputPolyfill(S),A(function(){u=I("FID"),l=N(a,u,void 0),window.webVitals.resetFirstInputPolyfill(),window.webVitals.firstInputPolyfill(S)}),t=en,i=I("CLS",0),(r=Qe("layout-shift",n))&&(o=N(t,i,void 0),rn(function(){r.takeRecords().map(n),o()}),A(function(){i=I("CLS",0),o=N(t,i,void 0)})),pe(this.publish.bind(this,e),!0)}catch(e){}function n(e){e.hadRecentInput||(i.value+=e.value,i.entries.push(e),o())}var t,o,i,r,a,s,u,c,l,f,d,p,h,g,m,v,y,w,b,E,R;function S(e){e.startTime<s.timeStamp&&(u.value=e.processingStart-e.startTime,u.entries.push(e),H.add(u),l())}function O(e){var n=e.startTime;n<h.timeStamp&&(g.value=n,g.entries.push(e)),d()}function T(e){"first-contentful-paint"===e.name&&(R&&R.disconnect(),e.startTime<w.timeStamp&&(b.value=e.startTime,b.entries.push(e),H.add(b),y()))}},publish:function(r){r.sendPipeline([function(e,n){var t,o=[];for(t in e)o.push(t+"="+e[t]);var i=-1===r.config.performanceUrl.indexOf("?")?"?":"&";n({url:r.config.webVitalsUrl+i+o.join("&"),type:R.VITALS,log:e,sendBeacon:!0})}],R.VITALS)(sn)},destroy:function(){this.option.publish=function(){}}}),cn=0,O=(B(on=b,n=tn=n),on.prototype=null===n?Object.create(n):(dn.prototype=n.prototype,new dn),b.prototype.getBean=function(n){var t=this;return void 0===n&&(n=[]),""+Object.getOwnPropertyNames(this.bean).filter(function(e){return-1===n.indexOf(e)}).map(function(e){return"from"===e?"from="+t.getCurrentPageUrl():e+"="+t.bean[e]}).join("&")},b.prototype.getCurrentPageUrl=function(){var e=this.config.pageUrl||location.href;return"function"==typeof this.config.urlHandler&&(e=this.config.urlHandler()),encodeURIComponent(e)},b.prototype.ready=function(){function r(){var e,t,o,i;n.reportRequestQueue.length&&(e=n.reportRequestQueue.splice(0,1)[0],t=e.options,o=e.success,i=e.fail,n.$request(t,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return null==o?void 0:o.apply(t,e)}finally{r()}},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return null==i?void 0:i.apply(t,e)}finally{r()}}))}var n=this;r(),this.isReportReady=!0},b.prototype.request=function(e,n,t){this.config.reportImmediately||this.isReportReady?this.$request(e,n,t):this.reportRequestQueue.push({options:e,success:n,fail:t})},b.prototype.$request=function(e,n,t){var o,i,r,a;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)return a=e.url,!1!==e.addBean&&(a=a+(-1===a.indexOf("?")?"?":"&")+this.getBean(e.beanFilter)),e.url=a,a=e.method||"get",(e=(i=this.config.onBeforeRequest)?i(e,this):e)?e.url?void((null!=e&&e.sendBeacon||this.sendNow)&&"function"==typeof(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)?navigator.sendBeacon(e.url,e.data):((o=new XMLHttpRequest).sendByAegis=!0,o.addEventListener("readystatechange",function(){4===o.readyState&&(400<=o.status||0===o.status?null!=t&&t(o.response):null!=n&&n(o.response))}),"get"===a.toLocaleLowerCase()?(o.open("get",(i=e.url,r=e.data,"string"!=typeof i?"":"object"==typeof r&&r?(a=Object.getOwnPropertyNames(r).map(function(e){var n=r[e];return e+"="+("string"==typeof n?encodeURIComponent(n):encodeURIComponent(JSON.stringify(n)))}).join("&").replace(/eval/gi,"evaI"),i+(-1===i.indexOf("?")?"?":"&")+a):i)),o.send()):(o.open("post",e.url),e.contentType&&o.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),o.send(e.data)))):console.warn("Please handle the parameters reasonably, options.url is necessary"):console.warn("Sending request blocked")},b.useAsyncPlugin=function(a,e){var n=(e=void 0===e?{}:e).exportsConstructor,s=void 0===n?"aegis-plugin-"+cn:n,n=e.onAegisInit,u=void 0===n?function(){}:n,n=e.onAegisInitAndPluginLoaded,c=void 0===n?function(){}:n;if(cn+=1,"string"!=typeof a)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof u||"function"!=typeof c)throw new TypeError("onAegisInit and onAegisInitAndPluginLoaded must be function");this.use(new t({name:"asyncPlugin",onNewAegis:function(n){try{u(n),b.asyncPlugin[a]?c(n,window[b.asyncPlugin[a]]):(e=a,t=s,o=function(e){e||(b.asyncPlugin[a]=s,e=window[s],c(n,e))},i=document.createElement("script"),r=document.head,"function"==typeof t&&(o=t,t=""),i.src=e,i.setAttribute("name",t),i.name=t,i.setAttribute("crossorigin","anonymous"),i.crossorigin="anonymous",i.defer=!0,i.hasLoaded=!1,i.onreadystatechange=function(){i.hasLoaded||i.readyState&&"loaded"!==i.readyState&&"complete"!==i.readyState||(i.hasLoaded=!0,"function"==typeof o&&o(!1),setTimeout(function(){r.contains(i)&&r.removeChild(i)}))},i.onload=i.onreadystatechange,i.onerror=function(){"function"==typeof o&&o(!0),setTimeout(function(){r.contains(i)&&r.removeChild(i)})},"complete"===document.readyState?r.appendChild(i):window.addEventListener("load",function(){r.appendChild(i)}))}catch(e){console.log("error on below is caused by "+a+" "),console.error(e)}var e,t,o,i,r}}))},b.prototype.publishPluginsLogs=function(){var e=b.installedPlugins.find(function(e){return"reportAssetSpeed"===e.name});null!=e&&e.option.collectNotReportedLog(this)},b.prototype.uploadLogs=function(e,n){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,n=void 0===n?{}:n)},b.sessionID="session-"+Date.now(),b.asyncPlugin={},b.urls={aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js"},b),ln=new t({name:"offlineLog"}),n=ln=new t({name:"offlineLog",onNewAegis:function(e){nn(O.urls.flog,e.config)}}),fn=(new t({name:"spa"}),new t({name:"spa",init:function(){history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState;var e=(null==(e=location.href)?void 0:e.split("?"))[0];this.$fireUrl=e,this.sendPv=this.sendPv.bind(this),this.onPageChange()},onPageChange:function(){window.addEventListener("replaceState",this.sendPv),window.addEventListener("pushState",this.sendPv),window.addEventListener("popstate",this.sendPv)},wr:function(t){var o=history[t],e="__"+t+"__hasWrittenByTamSpa";return"function"==typeof o&&!history[e]&&(Object.defineProperty(history,e,{value:!0,enumerable:!1}),function(){var e=o.apply(this,arguments),n=null;return"function"==typeof Event?n=new Event(t):(n=document.createEvent("HTMLEvents")).initEvent(t,!1,!0),window.dispatchEvent(n),e})},sendPv:function(){var n=this;setTimeout(function(){var o=location.href,e=(null==(e=location.href)?void 0:e.split("?"))[0];e&&e!==n.$fireUrl&&(n.$walk(function(t){t.sendPipeline([function(e,n){n({url:t.config.pvUrl+"?from="+encodeURIComponent(o),beanFilter:["from"],type:R.PV})}],R.PV)(null)}),n.$fireUrl=e)},0)},destroy:function(){window.removeEventListener("replaceState",this.option.sendPv),window.removeEventListener("pushState",this.option.sendPv),window.removeEventListener("popstate",this.option.sendPv)}}));function b(e){var n,t,o,i,r,a=tn.call(this,e)||this;a.sendNow=!1,a.isReportReady=!1,a.reportRequestQueue=[],a.speedLogPipeline=v([$(a),(i=a.config,r={},function(e,n){var t,o;i.speedSample?(o="object"==typeof i.repeat?i.repeat:{repeat:i.repeat},t=+o.speed||+o.repeat||5,Array.isArray(e)?(o=e.filter(function(e){var n=!r[e.url]||r[e.url]<t;return r[e.url]=1+~~r[e.url],n})).length&&n(o):(!r[e.url]||r[e.url]<t)&&(r[e.url]=1+~~r[e.url],n(e))):n(e)}),(o=a,function(n,t){De(function(e){o.extendBean("netType",e),t(n)})}),function(e,n){a.lifeCycle.emit("beforeReportSpeed",e);var t=a.config.beforeReportSpeed;if((e="function"==typeof t?e.filter(function(e){return!1!==t(e)}):e).length)return n(e)},function(e){return a.sendPipeline([function(e,n){var t,o,i,r;n({type:R.SPEED,url:""+a.config.speedUrl,method:"post",data:(n=e,t=E(E({},a.bean),{from:a.getCurrentPageUrl()}),i={fetch:[],static:[],bridge:[]},r=new FormData,Array.isArray(n)?n.forEach(function(e){var n=me(e);i[e.type].push(n)}):(o=me(n),i[n.type].push(o)),r.append("payload",oe(E({duration:i},t))),r),log:e})}],R.SPEED)(e)}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!=(n=document.cookie.match(/\buin=\D+(\d*)/))?n:[])[1]||(null!=(t=document.cookie.match(/\bilive_uin=\D*(\d+)/))?t:[])[1]||""),a.init(e),a.extendBean("sessionId",b.sessionID),a.extendBean("from",a.getCurrentPageUrl()),"undefined"!=typeof document&&a.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&a.extendBean("ext1",encodeURIComponent(e.ext1)),e.ext2&&a.extendBean("ext2",encodeURIComponent(e.ext2)),e.ext3&&a.extendBean("ext3",encodeURIComponent(e.ext3))}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.","color: red"),a.sendSDKError(e)}return a}function dn(){this.constructor=on}new t({name:"ie"}),new t({name:"onClose"});function pn(){for(var e,n=((t=(e=document.createElement("canvas")).getContext("2d"))?(t.font="14px 'Arial'",t.textBaseline="alphabetic",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("aegis,sdk <canvas> 1.0",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("aegis,sdk <canvas> 1.0",4,17),e.toDataURL("image/jpeg")):"")+function(){for(var e=function(){var e,i=document.getElementsByTagName("body")[0],r=document.createElement("span"),a=(r.style.fontSize="72px",r.innerHTML="mmmmmmmmmmlli",{}),s={};for(e in j)r.style.fontFamily=j[e],i.appendChild(r),a[j[e]]=r.offsetWidth,s[j[e]]=r.offsetHeight,i.removeChild(r);return{detect:function(e){var n,t=!1;for(n in j){r.style.fontFamily=e+","+j[n],i.appendChild(r);var o=r.offsetWidth!==a[j[n]]||r.offsetHeight!==s[j[n]];i.removeChild(r),t=t||o}return t}}}(),n=gn||[],t="",o=0;o<n.length;o++)t+=e.detect(n[o])?"1":"0";return t}(),t=3&n.length,o=n.length-t,i=1,r=3432918353,a=461845907,s=0;s<o;){var u=255&n.charCodeAt(s)|(255&n.charCodeAt(++s))<<8|(255&n.charCodeAt(++s))<<16|(255&n.charCodeAt(++s))<<24;++s,i=27492+(65535&(u=5*(65535&(i=(i^=(65535&(u=(u=(65535&u)*r+(((u>>>16)*r&65535)<<16)&4294967295)<<15|u>>>17))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16)}var c=0;switch(t){case 3:c^=(255&n.charCodeAt(s+2))<<16;case 2:c^=(255&n.charCodeAt(s+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&n.charCodeAt(s)))*r+(((c>>>16)*r&65535)<<16)&4294967295)<<15|c>>>17))*a+(((c>>>16)*a&65535)<<16)&4294967295}i=2246822507*(65535&(i=(i^=n.length)^i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295;for(var l=(i^=i>>>16)>>>0,f=(l%2).toString();1<l;)f=(l=parseInt((l/2).toString(),10))%2+f;for(;f.length<32;)f="0"+f;return f}var hn=new t({name:"onClose",onNewAegis:function(){var t,o=this;r.desktop()?(t=window.onunload,window.onunload=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];o.publishNotReportedLog(),null!=t&&t.call.apply(t,u([window],e))}):pe(this.publishNotReportedLog.bind(this),!0)},publishNotReportedLog:function(){var n=this;this.$walk(function(e){e.sendNow=!0,e.publishPluginsLogs(),n.publishThrottlePipeLogs(e)})},publishThrottlePipeLogs:function(e){null!=e&&e.speedLogPipeline([]),null!=e&&e.eventPipeline([]),null!=e&&e.customTimePipeline([]),null!=e&&e.normalLogPipeline([])}}),j=(new t({name:"aid"}),["monospace","sans-serif","serif"]),gn=["default","sans-serif","serif","monospace","Apple LiSung","Apple SD Gothic Neo","Apple Symbols","Baoli SC, Baoli TC","Baskerville","Beirut","GungSeo","Gurmukhi MN","Gurmukhi MT","Hannotate SC, Hannotate TC","HanziPen SC, HanziPen TC","HeadlineA","Hei","LiSong Pro","Libian SC, Libian TC","LingWai SC, LingWai TC","Lucida Grande","Luminari","Nanum Brush Script","Nanum Gothic, NanumGothic","Nanum Myeongjo, NanumMyeongjo","Nanum Pen Script","NanumGothic ExtraBold, NanumGothicExtraBold","New Peninim MT","Noto Serif Kannada","Noto Serif Myanmar","Optima","PilGi","Plantagenet Cherokee","Raanana","STFangSong, STFangsong","STHeiti","STIXGeneral, STIXGeneral-Regular","Tsukushi B Round Gothic, Tsukushi B Round Gothic Regular","Tsukushi B Round Gothic Bold","Verdana","Waseem","Xingkai SC, Xingkai TC","YuGothic, YuGothic Medium","YuGothic Bold","Yuanti SC, Yuanti TC","Yuppy SC, Yuppy TC","Zapf Dingbats"],mn=new t({name:"aid",aid:"",init:function(e){try{var n=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");n||(n=pn()||V(),window.localStorage.setItem("AEGIS_ID",n)),this.aid=n}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}});return O.use(Ge),O.use(Ne),O.use(ye),O.use(Ve),O.use(un),O.use(mn),O.use(m),O.use(n),O.use(fn),O.use(hn),O.use(He),O});
